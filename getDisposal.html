<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>폐기 조회</title>
    <style>


        body {
background-color: #f8f9fa;
color: #333;
display: flex;
height: 100vh;
overflow: hidden;
}

/* 사이드바 스타일 */
.sidebar {
width: 260px;
background-color: white;
border-right: 1px solid #e5e7eb;
display: flex;
flex-direction: column;
}

.sidebar-header {
padding: 16px;
border-bottom: 1px solid #e5e7eb;
}

.logo-container {
display: flex;
align-items: center;
}

.logo {
height: 32px;
width: 32px;
color: #4f46e5;
}

.logo-text {
margin-left: 8px;
font-size: 18px;
font-weight: 600;
color: #1f2937;
}

.sidebar-content {
flex: 1;
overflow-y: auto;
padding: 16px 0;
}

.nav-menu {
list-style: none;
padding: 0 8px;
}

.nav-item {
margin-bottom: 4px;
transition: all 0.2s;
border-radius: 6px;
}

.nav-link {
display: flex;
align-items: center;
padding: 12px 16px;
color: #4b5563;
text-decoration: none;
font-size: 14px;
font-weight: 500;
border-radius: 6px;
}

.nav-link:hover {
background-color: rgba(79, 70, 229, 0.1);
}

.nav-link.active {
background-color: rgba(79, 70, 229, 0.2);
color: #4f46e5;
border-left: 3px solid #4f46e5;
}

.nav-icon {
height: 20px;
width: 20px;
margin-right: 12px;
}

.submenu-toggle {
width: 100%;
display: flex;
align-items: center;
justify-content: space-between;
background: none;
border: none;
cursor: pointer;
padding: 12px 16px;
color: #4b5563;
font-size: 14px;
font-weight: 500;
text-align: left;
}

.submenu-toggle:hover {
background-color: rgba(79, 70, 229, 0.1);
}

.submenu-icon {
height: 20px;
width: 20px;
margin-right: 12px;
}

.arrow-icon {
height: 16px;
width: 16px;
transition: transform 0.3s;
}

.arrow-icon.rotate {
transform: rotate(180deg);
}

.submenu {
padding-left: 24px;
max-height: 0;
overflow: hidden;
transition: max-height 0.3s ease-in-out;
}

.submenu.open {
max-height: 500px;
}

.submenu-item {
padding: 8px 16px;
font-size: 14px;
color: #4b5563;
display: block;
text-decoration: none;
border-radius: 6px;
margin-bottom: 2px;
}

.submenu-item:hover {
background-color: rgba(79, 70, 229, 0.1);
}

.sidebar-footer {
padding: 16px;
border-top: 1px solid #e5e7eb;
}

.user-info {
display: flex;
align-items: center;
}

.user-avatar {
height: 32px;
width: 32px;
border-radius: 50%;
background-color: #e0e7ff;
color: #4f46e5;
display: flex;
align-items: center;
justify-content: center;
}

.user-details {
margin-left: 12px;
}

.user-name {
font-size: 14px;
font-weight: 500;
color: #1f2937;
}

.user-role {
font-size: 12px;
color: #6b7280;
}

/* 메인 콘텐츠 스타일 */
.main-container {
flex: 1;
display: flex;
flex-direction: column;
overflow: hidden;
}

.header {
background-color: white;
box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
padding: 16px 24px;
z-index: 10;
}

.header-content {
max-width: 1280px;
margin: 0 auto;
display: flex;
align-items: center;
justify-content: space-between;
}

.page-title {
font-size: 18px;
font-weight: 600;
color: #1f2937;
}

.header-actions {
display: flex;
align-items: center;
gap: 16px;
}

.notification-btn {
background: none;
border: none;
cursor: pointer;
padding: 4px;
border-radius: 50%;
color: #6b7280;
}

.main-content {
flex: 1;
overflow-y: auto;
padding: 24px;
}

.content-wrapper {
max-width: 1280px;
margin: 0 auto;
}

/* 검색 필터 스타일 */
.filter-container {
background-color: white;
border-radius: 12px;
box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
padding: 24px;
margin-bottom: 24px;
}

.filter-title {
font-size: 16px;
font-weight: 600;
color: #1f2937;
margin-bottom: 16px;
padding-bottom: 16px;
border-bottom: 1px solid #e5e7eb;
}

.filter-form {
display: grid;
grid-template-columns: repeat(3, 1fr);
gap: 16px;
}

.form-group {
margin-bottom: 16px;
}

.form-label {
display: block;
font-size: 14px;
font-weight: 500;
color: #4b5563;
margin-bottom: 8px;
}

.form-control {
width: 100%;
padding: 10px 12px;
font-size: 14px;
border: 1px solid #d1d5db;
border-radius: 6px;
background-color: white;
color: #1f2937;
transition: border-color 0.2s, box-shadow 0.2s;
}

.form-control:focus {
outline: none;
border-color: #4f46e5;
box-shadow: 0 0 0 2px rgba(79, 70, 229, 0.2);
}

.form-select {
width: 100%;
padding: 10px 12px;
font-size: 14px;
border: 1px solid #d1d5db;
border-radius: 6px;
background-color: white;
color: #1f2937;
transition: border-color 0.2s, box-shadow 0.2s;
appearance: none;
background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 20 20' fill='%236b7280'%3E%3Cpath fill-rule='evenodd' d='M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z' clip-rule='evenodd' /%3E%3C/svg%3E");
background-position: right 10px center;
background-repeat: no-repeat;
background-size: 20px 20px;
padding-right: 40px;
}

.form-select:focus {
outline: none;
border-color: #4f46e5;
box-shadow: 0 0 0 2px rgba(79, 70, 229, 0.2);
}

.date-range {
display: flex;
align-items: center;
gap: 8px;
}

.date-range .form-control {
flex: 1;
}

.date-separator {
color: #6b7280;
}

.filter-actions {
grid-column: 1 / -1;
display: flex;
justify-content: flex-end;
gap: 12px;
margin-top: 8px;
}

.btn {
padding: 10px 16px;
font-size: 14px;
font-weight: 500;
border-radius: 6px;
cursor: pointer;
transition: all 0.2s;
border: none;
}

.btn-primary {
background-color: #4f46e5;
color: white;
}

.btn-primary:hover {
background-color: #4338ca;
}

.btn-secondary {
background-color: #f3f4f6;
color: #4b5563;
}

.btn-secondary:hover {
background-color: #e5e7eb;
}

/* 테이블 스타일 */
.table-container {
background-color: white;
border-radius: 12px;
box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
overflow: hidden;
}

.table-header {
padding: 16px 24px;
border-bottom: 1px solid #e5e7eb;
display: flex;
justify-content: space-between;
align-items: center;
}

.table-title {
font-size: 16px;
font-weight: 600;
color: #1f2937;
}

.table-actions {
display: flex;
gap: 8px;
}

.table {
width: 100%;
border-collapse: collapse;
}

.table th {
background-color: #f9fafb;
padding: 12px 16px;
text-align: left;
font-size: 12px;
font-weight: 600;
color: #6b7280;
text-transform: uppercase;
letter-spacing: 0.05em;
border-bottom: 1px solid #e5e7eb;
}

.table td {
padding: 12px 16px;
font-size: 14px;
color: #4b5563;
border-bottom: 1px solid #e5e7eb;
}

.table tr:last-child td {
border-bottom: none;
}

.table tr:hover {
background-color: #f9fafb;
}

.badge {
display: inline-block;
padding: 2px 8px;
font-size: 12px;
font-weight: 500;
border-radius: 9999px;
}

.badge-success {
background-color: #d1fae5;
color: #065f46;
}

.badge-warning {
background-color: #fef3c7;
color: #92400e;
}

.badge-danger {
background-color: #fee2e2;
color: #b91c1c;
}

.badge-info {
background-color: #e0f2fe;
color: #0369a1;
}

/* 페이지네이션 스타일 */
.pagination-container {
display: flex;
justify-content: center;
margin-top: 24px;
}

.pagination {
display: flex;
list-style: none;
padding: 0;
margin: 0;
border-radius: 6px;
overflow: hidden;
box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
}

.page-item {
border-right: 1px solid #e5e7eb;
}

.page-item:last-child {
border-right: none;
}

.page-link {
display: flex;
align-items: center;
justify-content: center;
padding: 8px 12px;
font-size: 14px;
color: #4b5563;
background-color: white;
border: none;
cursor: pointer;
transition: all 0.2s;
min-width: 40px;
}

.page-link:hover {
background-color: #f3f4f6;
}

.page-item.active .page-link {
background-color: #4f46e5;
color: white;
}

.page-item.disabled .page-link {
color: #d1d5db;
cursor: not-allowed;
}

/* 모달 스타일 */
.modal-backdrop {
position: fixed;
top: 0;
left: 0;
width: 100%;
height: 100%;
background-color: rgba(0, 0, 0, 0.5);
display: flex;
align-items: center;
justify-content: center;
z-index: 50;
opacity: 0;
visibility: hidden;
transition: opacity 0.3s, visibility 0.3s;
}

.modal-backdrop.show {
opacity: 1;
visibility: visible;
}

.modal {
background-color: white;
border-radius: 12px;
box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
width: 100%;
max-width: 600px;
max-height: 90vh;
overflow-y: auto;
transform: translateY(20px);
opacity: 0;
transition: transform 0.3s, opacity 0.3s;
}

.modal-backdrop.show .modal {
transform: translateY(0);
opacity: 1;
}

.modal-header {
padding: 16px 24px;
border-bottom: 1px solid #e5e7eb;
display: flex;
align-items: center;
justify-content: space-between;
}

.modal-title {
font-size: 18px;
font-weight: 600;
color: #1f2937;
}

.modal-close {
background: none;
border: none;
cursor: pointer;
color: #6b7280;
padding: 4px;
border-radius: 50%;
display: flex;
align-items: center;
justify-content: center;
}

.modal-body {
padding: 24px;
}

.modal-footer {
padding: 16px 24px;
border-top: 1px solid #e5e7eb;
display: flex;
justify-content: flex-end;
gap: 12px;
}

/* 상세 정보 스타일 */
.detail-grid {
display: grid;
grid-template-columns: repeat(2, 1fr);
gap: 16px;
}

.detail-item {
margin-bottom: 16px;
}

.detail-label {
font-size: 12px;
font-weight: 600;
color: #6b7280;
margin-bottom: 4px;
text-transform: uppercase;
letter-spacing: 0.05em;
}

.detail-value {
font-size: 14px;
color: #1f2937;
}

/* 토스트 알림 스타일 */
.toast-container {
position: fixed;
bottom: 24px;
right: 24px;
z-index: 100;
}

.toast {
background-color: white;
border-radius: 8px;
box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
padding: 16px;
margin-top: 8px;
display: flex;
align-items: center;
min-width: 300px;
transform: translateX(100%);
opacity: 0;
transition: transform 0.3s, opacity 0.3s;
}

.toast.show {
transform: translateX(0);
opacity: 1;
}

.toast-icon {
margin-right: 12px;
flex-shrink: 0;
}

.toast-content {
flex: 1;
}

.toast-title {
font-weight: 600;
margin-bottom: 4px;
}

.toast-message {
font-size: 14px;
color: #4b5563;
}

.toast-close {
background: none;
border: none;
cursor: pointer;
color: #6b7280;
padding: 4px;
margin-left: 8px;
}

.toast-success {
border-left: 4px solid #10b981;
}

.toast-error {
border-left: 4px solid #ef4444;
}

/* 반응형 스타일 */
@media (max-width: 1024px) {
.filter-form {
grid-template-columns: repeat(2, 1fr);
}

.detail-grid {
grid-template-columns: 1fr;
}
}

@media (max-width: 768px) {
.sidebar {
width: 80px;
}

.logo-text, .nav-text, .user-details {
display: none;
}

.submenu-toggle {
justify-content: center;
padding: 12px;
}

.submenu-icon {
margin-right: 0;
}

.arrow-icon {
display: none;
}

.filter-form {
grid-template-columns: 1fr;
}

.table-container {
overflow-x: auto;
}

.table {
min-width: 800px;
}
}

/* 유틸리티 클래스 */
.hidden {
display: none;
}

.mt-4 {
margin-top: 16px;
}

.text-center {
text-align: center;
}

.text-right {
text-align: right;
}

.text-muted {
color: #6b7280;
}

.loading-spinner {
display: inline-block;
width: 24px;
height: 24px;
border: 3px solid rgba(79, 70, 229, 0.3);
border-radius: 50%;
border-top-color: #4f46e5;
animation: spin 1s ease-in-out infinite;
}

@keyframes spin {
to {
transform: rotate(360deg);
}
}

.loading-container {
display: flex;
align-items: center;
justify-content: center;
padding: 48px 0;
}

.loading-text {
margin-left: 12px;
font-size: 14px;
color: #6b7280;
}

.empty-state {
padding: 48px 0;
text-align: center;
}

.empty-icon {
width: 64px;
height: 64px;
margin: 0 auto 16px;
color: #d1d5db;
}

.empty-title {
font-size: 16px;
font-weight: 600;
color: #1f2937;
margin-bottom: 8px;
}

.empty-description {
font-size: 14px;
color: #6b7280;
max-width: 300px;
margin: 0 auto;
}
</style>
</head>
<body>
<!-- 메인 콘텐츠 -->
<div class="main-container">
    <!-- 헤더 -->
    <div class="header">
        <div class="header-content">
            <h1 class="page-title">폐기 조회</h1>
            <div class="header-actions">
                <button class="notification-btn">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" class="w-6 h-6">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9" />
                    </svg>
                </button>
            </div>
        </div>
    </div>

    <!-- 메인 콘텐츠 영역 -->
    <div class="main-content">
        <div class="content-wrapper">
            <!-- 검색 필터 -->
            <div class="filter-container">
                <h2 class="filter-title">검색 필터</h2>
                <form id="searchForm" class="filter-form">
                    <div class="form-group">
                        <label for="franchiseName" class="form-label">가맹점명</label>
                        <input type="text" id="franchiseName" name="franchiseName" class="form-control" placeholder="가맹점명 입력">
                    </div>
                    <div class="form-group">
                        <label for="warehouseName" class="form-label">창고명</label>
                        <input type="text" id="warehouseName" name="warehouseName" class="form-control" placeholder="창고명 입력">
                    </div>
                    <div class="form-group">
                        <label for="productName" class="form-label">상품명</label>
                        <input type="text" id="productName" name="productName" class="form-control" placeholder="상품명 입력">
                    </div>
                    <div class="form-group">
                        <label for="categoryName" class="form-label">카테고리명</label>
                        <input type="text" id="categoryName" name="categoryName" class="form-control" placeholder="카테고리명 입력">
                    </div>
                    <div class="form-group">
                        <label for="disposalType" class="form-label">폐기 유형</label>
                        <select id="disposalType" name="disposalType" class="form-select">
                            <option value="">전체</option>
                            <option value="NORMAL">일반 폐기</option>
                            <option value="TAKEBACK">반품 폐기</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="dateRange" class="form-label">폐기 일자</label>
                        <div class="date-range">
                            <input type="date" id="startDate" name="startDate" class="form-control">
                            <span class="date-separator">~</span>
                            <input type="date" id="endDate" name="endDate" class="form-control">
                        </div>
                    </div>
                    <div class="filter-actions">
                        <button type="button" id="resetButton" class="btn btn-secondary">초기화</button>
                        <button type="submit" class="btn btn-primary">검색</button>
                    </div>
                </form>
            </div>

            <!-- 폐기 내역 테이블 -->
            <div class="table-container">
                <div class="table-header">
                    <h2 class="table-title">폐기 내역</h2>
                    <div class="table-actions">
                        <button type="button" id="exportExcel" class="btn btn-secondary">
                            <svg viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5" style="width: 20px; height: 20px; margin-right: 4px; vertical-align: text-bottom;">
                                <path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z" clip-rule="evenodd" />
                            </svg>
                            엑셀 다운로드
                        </button>
                    </div>
                </div>
                <div id="tableContainer">
                    <table class="table">
                        <thead>
                        <tr>
                            <th>폐기 ID</th>
                            <th>가맹점/창고</th>
                            <th>상품명</th>
                            <th>카테고리</th>
                            <th>수량</th>
                            <th>폐기 유형</th>
                            <th>폐기 사유</th>
                            <th>폐기 일자</th>
                            <th>상세</th>
                        </tr>
                        </thead>
                        <tbody id="disposalTableBody">
                        <!-- 데이터가 여기에 로드됩니다 -->
                        </tbody>
                    </table>
                    <!-- 로딩 상태 -->
                    <div id="loadingState" class="loading-container hidden">
                        <div class="loading-spinner"></div>
                        <span class="loading-text">데이터를 불러오는 중입니다...</span>
                    </div>
                    <!-- 빈 상태 -->
                    <div id="emptyState" class="empty-state hidden">
                        <svg class="empty-icon" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd" />
                        </svg>
                        <h3 class="empty-title">검색 결과가 없습니다</h3>
                        <p class="empty-description">검색 조건을 변경하여 다시 시도해보세요.</p>
                    </div>
                </div>
            </div>

            <!-- 페이지네이션 -->
            <div class="pagination-container">
                <ul class="pagination" id="pagination">
                    <!-- 페이지네이션이 여기에 로드됩니다 -->
                </ul>
            </div>
        </div>
    </div>
</div>

<!-- 폐기 상세 모달 -->
<div class="modal-backdrop" id="disposalDetailModal">
    <div class="modal">
        <div class="modal-header">
            <h3 class="modal-title">폐기 상세 정보</h3>
            <button class="modal-close" id="closeDetailModal">
                <svg viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5">
                    <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd" />
                </svg>
            </button>
        </div>
        <div class="modal-body">
            <div class="detail-grid">
                <div class="detail-item">
                    <div class="detail-label">폐기 ID</div>
                    <div class="detail-value" id="detailDisposalId">-</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">폐기 일자</div>
                    <div class="detail-value" id="detailDisposalDate">-</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">가맹점</div>
                    <div class="detail-value" id="detailFranchise">-</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">창고</div>
                    <div class="detail-value" id="detailWarehouse">-</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">상품명</div>
                    <div class="detail-value" id="detailProductName">-</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">카테고리</div>
                    <div class="detail-value" id="detailCategory">-</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">수량</div>
                    <div class="detail-value" id="detailQuantity">-</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">폐기 유형</div>
                    <div class="detail-value" id="detailDisposalType">-</div>
                </div>
            </div>
            <div class="detail-item">
                <div class="detail-label">폐기 사유</div>
                <div class="detail-value" id="detailReason">-</div>
            </div>
            <div class="detail-item" id="detailTakebackContainer">
                <div class="detail-label">반품 정보</div>
                <div class="detail-value" id="detailTakeback">-</div>
            </div>
            <div class="detail-item">
                <div class="detail-label">등록자</div>
                <div class="detail-value" id="detailCreatedBy">-</div>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn btn-secondary" id="closeDetailModalBtn">닫기</button>
        </div>
    </div>
</div>

<!-- 토스트 알림 컨테이너 -->
<div class="toast-container" id="toastContainer"></div>

<script>
    // DOM 요소 로드 후 실행
    document.addEventListener('DOMContentLoaded', function() {
        // 전역 변수
        let currentPage = 0;
        let totalPages = 0;
        let pageSize = 10;
        let currentSearchParams = {};

        // 요소 참조
        const searchForm = document.getElementById('searchForm');
        const resetButton = document.getElementById('resetButton');
        const disposalTableBody = document.getElementById('disposalTableBody');
        const pagination = document.getElementById('pagination');
        const loadingState = document.getElementById('loadingState');
        const emptyState = document.getElementById('emptyState');
        const exportExcel = document.getElementById('exportExcel');
        const disposalDetailModal = document.getElementById('disposalDetailModal');
        const closeDetailModal = document.getElementById('closeDetailModal');
        const closeDetailModalBtn = document.getElementById('closeDetailModalBtn');

        // 사이드바 토글 기능
        document.querySelector('.submenu-toggle').addEventListener('click', function() {
            const submenu = document.querySelector('.submenu');
            const arrow = document.querySelector('.arrow-icon');
            submenu.classList.toggle('open');
            arrow.classList.toggle('rotate');
        });

        // 초기 데이터 로드
        loadDisposals();

        // 검색 폼 제출 이벤트
        searchForm.addEventListener('submit', function(event) {
            event.preventDefault();
            currentPage = 0;
            const formData = new FormData(searchForm);
            currentSearchParams = Object.fromEntries(formData.entries());
            loadDisposals();
        });

        // 검색 폼 초기화 이벤트
        resetButton.addEventListener('click', function() {
            searchForm.reset();
            currentPage = 0;
            currentSearchParams = {};
            loadDisposals();
        });

        // 모달 닫기 이벤트
        closeDetailModal.addEventListener('click', function() {
            disposalDetailModal.classList.remove('show');
        });

        closeDetailModalBtn.addEventListener('click', function() {
            disposalDetailModal.classList.remove('show');
        });

        // 엑셀 다운로드 이벤트
        exportExcel.addEventListener('click', function() {
            exportToExcel();
        });

        // 폐기 내역 로드 함수
        function loadDisposals() {
            showLoading();

            // 검색 파라미터 구성
            const params = new URLSearchParams({
                ...currentSearchParams,
                page: currentPage,
                size: pageSize
            });

            // 빈 값 제거
            for (const [key, value] of params.entries()) {
                if (!value) {
                    params.delete(key);
                }
            }

            // API 호출
            fetch(`/api/v1/disposal?${params.toString()}`)
                .then(response => {
                    if (!response.ok) {
                        throw new Error('폐기 내역을 불러오는데 실패했습니다.');
                    }
                    return response.json();
                })
                .then(data => {
                    const result = data.data;
                    renderDisposals(result.content);
                    renderPagination(result.totalPages);
                    hideLoading();
                })
                .catch(error => {
                    console.error('Error:', error);
                    showToast(error.message, 'error');
                    hideLoading();
                    showEmptyState();
                });
        }

        // 폐기 내역 렌더링 함수
        function renderDisposals(disposals) {
            if (!disposals || disposals.length === 0) {
                showEmptyState();
                return;
            }

            hideEmptyState();
            disposalTableBody.innerHTML = '';

            disposals.forEach(disposal => {
                const row = document.createElement('tr');

                // 폐기 유형에 따른 배지 스타일 결정
                let disposalTypeBadge = '';
                if (disposal.disposalType === 'NORMAL') {
                    disposalTypeBadge = '<span class="badge badge-info">일반 폐기</span>';
                } else if (disposal.disposalType === 'TAKEBACK') {
                    disposalTypeBadge = '<span class="badge badge-warning">반품 폐기</span>';
                }

                // 폐기 사유 길이 제한
                const reasonShort = disposal.disposalReason.length > 20
                    ? disposal.disposalReason.substring(0, 20) + '...'
                    : disposal.disposalReason;

                row.innerHTML = `
                    <td>${disposal.disposalId}</td>
                    <td>${disposal.franchiseName || '-'} / ${disposal.warehouseName || '-'}</td>
                    <td>${disposal.productName}</td>
                    <td>${disposal.categoryName}</td>
                    <td>${disposal.quantity}</td>
                    <td>${disposalTypeBadge}</td>
                    <td title="${disposal.disposalReason}">${reasonShort}</td>
                    <td>${formatDate(disposal.disposalDate)}</td>
                    <td>
                        <button class="btn btn-secondary btn-sm view-detail" data-id="${disposal.disposalId}">
                            상세
                        </button>
                    </td>
                `;

                disposalTableBody.appendChild(row);
            });

            // 상세 버튼 이벤트 추가
            document.querySelectorAll('.view-detail').forEach(button => {
                button.addEventListener('click', function() {
                    const disposalId = this.getAttribute('data-id');
                    showDisposalDetail(disposalId);
                });
            });
        }

        // 페이지네이션 렌더링 함수
        function renderPagination(totalPages) {
            pagination.innerHTML = '';

            if (totalPages <= 1) {
                return;
            }

            // 이전 페이지 버튼
            const prevItem = document.createElement('li');
            prevItem.className = `page-item ${currentPage === 0 ? 'disabled' : ''}`;
            prevItem.innerHTML = `
                <button class="page-link" ${currentPage === 0 ? 'disabled' : ''}>
                    <svg viewBox="0 0 20 20" fill="currentColor" style="width: 16px; height: 16px;">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd" />
                    </svg>
                </button>
            `;
            pagination.appendChild(prevItem);

            if (currentPage > 0) {
                prevItem.addEventListener('click', function() {
                    currentPage--;
                    loadDisposals();
                });
            }

            // 페이지 번호 버튼
            const maxVisiblePages = 5;
            let startPage = Math.max(0, currentPage - Math.floor(maxVisiblePages / 2));
            let endPage = Math.min(totalPages - 1, startPage + maxVisiblePages - 1);

            if (endPage - startPage < maxVisiblePages - 1) {
                startPage = Math.max(0, endPage - maxVisiblePages + 1);
            }

            for (let i = startPage; i <= endPage; i++) {
                const pageItem = document.createElement('li');
                pageItem.className = `page-item ${i === currentPage ? 'active' : ''}`;
                pageItem.innerHTML = `<button class="page-link">${i + 1}</button>`;

                if (i !== currentPage) {
                    pageItem.addEventListener('click', function() {
                        currentPage = i;
                        loadDisposals();
                    });
                }

                pagination.appendChild(pageItem);
            }

            // 다음 페이지 버튼
            const nextItem = document.createElement('li');
            nextItem.className = `page-item ${currentPage === totalPages - 1 ? 'disabled' : ''}`;
            nextItem.innerHTML = `
                <button class="page-link" ${currentPage === totalPages - 1 ? 'disabled' : ''}>
                    <svg viewBox="0 0 20 20" fill="currentColor" style="width: 16px; height: 16px;">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd" />
                    </svg>
                </button>
            `;
            pagination.appendChild(nextItem);

            if (currentPage < totalPages - 1) {
                nextItem.addEventListener('click', function() {
                    currentPage++;
                    loadDisposals();
                });
            }
        }

        // 폐기 상세 정보 표시 함수
        function showDisposalDetail(disposalId) {
            // API 호출 (실제로는 상세 API를 호출해야 함)
            fetch(`/api/v1/disposal/${disposalId}`)
                .then(response => {
                    if (!response.ok) {
                        throw new Error('폐기 상세 정보를 불러오는데 실패했습니다.');
                    }
                    return response.json();
                })
                .then(data => {
                    const disposal = data.data;

                    // 모달에 데이터 표시
                    document.getElementById('detailDisposalId').textContent = disposal.disposalId;
                    document.getElementById('detailDisposalDate').textContent = formatDate(disposal.disposalDate);
                    document.getElementById('detailFranchise').textContent = disposal.franchiseName || '-';
                    document.getElementById('detailWarehouse').textContent = disposal.warehouseName || '-';
                    document.getElementById('detailProductName').textContent = disposal.productName;
                    document.getElementById('detailCategory').textContent = disposal.categoryName;
                    document.getElementById('detailQuantity').textContent = disposal.quantity;
                    document.getElementById('detailDisposalType').textContent = disposal.disposalType === 'NORMAL' ? '일반 폐기' : '반품 폐기';
                    document.getElementById('detailReason').textContent = disposal.disposalReason;
                    document.getElementById('detailCreatedBy').textContent = disposal.createdBy;

                    // 반품 정보 표시 여부
                    const takebackContainer = document.getElementById('detailTakebackContainer');
                    if (disposal.disposalType === 'TAKEBACK' && disposal.takebackId) {
                        takebackContainer.classList.remove('hidden');
                        document.getElementById('detailTakeback').textContent = `반품 ID: ${disposal.takebackId}`;
                    } else {
                        takebackContainer.classList.add('hidden');
                    }

                    // 모달 표시
                    disposalDetailModal.classList.add('show');
                })
                .catch(error => {
                    console.error('Error:', error);
                    showToast(error.message, 'error');
                });
        }

        // 엑셀 다운로드 함수
        function exportToExcel() {
            // 검색 파라미터 구성
            const params = new URLSearchParams({
                ...currentSearchParams,
                export: 'excel'
            });

            // 빈 값 제거
            for (const [key, value] of params.entries()) {
                if (!value) {
                    params.delete(key);
                }
            }

            // 다운로드 URL 생성
            const downloadUrl = `/api/v1/disposal/export?${params.toString()}`;

            // 다운로드 링크 생성 및 클릭
            const link = document.createElement('a');
            link.href = downloadUrl;
            link.download = `폐기내역_${formatDateForFilename(new Date())}.xlsx`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);

            showToast('엑셀 파일 다운로드가 시작됩니다.', 'success');
        }

        // 로딩 상태 표시 함수
        function showLoading() {
            loadingState.classList.remove('hidden');
            disposalTableBody.innerHTML = '';
        }

        // 로딩 상태 숨김 함수
        function hideLoading() {
            loadingState.classList.add('hidden');
        }

        // 빈 상태 표시 함수
        function showEmptyState() {
            emptyState.classList.remove('hidden');
        }

        // 빈 상태 숨김 함수
        function hideEmptyState() {
            emptyState.classList.add('hidden');
        }

        // 날짜 포맷 함수
        function formatDate(dateString) {
            if (!dateString) return '-';
            const date = new Date(dateString);
            return date.toLocaleDateString('ko-KR', {
                year: 'numeric',
                month: '2-digit',
                day: '2-digit',
                hour: '2-digit',
                minute: '2-digit'
            });
        }

        // 파일명용 날짜 포맷 함수
        function formatDateForFilename(date) {
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            return `${year}${month}${day}`;
        }

        // 토스트 알림 표시 함수
        function showToast(message, type = 'info') {
            const toastContainer = document.getElementById('toastContainer');
            const toast = document.createElement('div');
            toast.className = `toast toast-${type}`;

            let iconSvg = '';
            let title = '';

            switch (type) {
                case 'success':
                    iconSvg = '<svg viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5" style="color: #10b981;"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" /></svg>';
                    title = '성공';
                    break;
                case 'error':
                    iconSvg = '<svg viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5" style="color: #ef4444;"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd" /></svg>';
                    title = '오류';
                    break;
                default:
                    iconSvg = '<svg viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5" style="color: #3b82f6;"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd" /></svg>';
                    title = '알림';
            }

            toast.innerHTML = `
                <div class="toast-icon">${iconSvg}</div>
                <div class="toast-content">
                    <div class="toast-title">${title}</div>
                    <div class="toast-message">${message}</div>
                </div>
                <button class="toast-close">
                    <svg viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd" />
                    </svg>
                </button>
            `;

            toastContainer.appendChild(toast);

            // 토스트 표시 애니메이션
            setTimeout(() => {
                toast.classList.add('show');
            }, 10);

            // 토스트 닫기 버튼 이벤트
            toast.querySelector('.toast-close').addEventListener('click', () => {
                toast.classList.remove('show');
                setTimeout(() => {
                    toastContainer.removeChild(toast);
                }, 300);
            });

            // 3초 후 자동으로 토스트 닫기
            setTimeout(() => {
                if (toastContainer.contains(toast)) {
                    toast.classList.remove('show');
                    setTimeout(() => {
                        if (toastContainer.contains(toast)) {
                            toastContainer.removeChild(toast);
                        }
                    }, 300);
                }
            }, 3000);
        }

        // 샘플 데이터 (실제로는 API에서 가져옴)
        function getSampleData() {
            return {
                content: [
                    {
                        disposalId: 'D-20230001',
                        franchiseName: '강남점',
                        warehouseName: '강남 창고',
                        productName: '아메리카노',
                        categoryName: '음료',
                        quantity: 5,
                        disposalType: 'NORMAL',
                        disposalReason: '유통기한 만료',
                        disposalDate: '2023-06-15T14:30:00',
                        createdBy: '김관리'
                    },
                    {
                        disposalId: 'D-20230002',
                        franchiseName: '홍대점',
                        warehouseName: '홍대 창고',
                        productName: '카페라떼',
                        categoryName: '음료',
                        quantity: 3,
                        disposalType: 'NORMAL',
                        disposalReason: '품질 불량',
                        disposalDate: '2023-06-14T11:20:00',
                        createdBy: '이매니저'
                    },
                    {
                        disposalId: 'D-20230003',
                        franchiseName: '신촌점',
                        warehouseName: '신촌 창고',
                        productName: '바닐라 시럽',
                        categoryName: '시럽',
                        quantity: 2,
                        disposalType: 'TAKEBACK',
                        disposalReason: '포장 손상',
                        disposalDate: '2023-06-13T09:45:00',
                        takebackId: 'TB-20230001',
                        createdBy: '박직원'
                    },
                    {
                        disposalId: 'D-20230004',
                        franchiseName: '건대점',
                        warehouseName: '건대 창고',
                        productName: '초콜릿 파우더',
                        categoryName: '파우더',
                        quantity: 1,
                        disposalType: 'NORMAL',
                        disposalReason: '습기 노출',
                        disposalDate: '2023-06-12T16:10:00',
                        createdBy: '최담당'
                    },
                    {
                        disposalId: 'D-20230005',
                        franchiseName: '종로점',
                        warehouseName: '종로 창고',
                        productName: '헤이즐넛 시럽',
                        categoryName: '시럽',
                        quantity: 4,
                        disposalType: 'TAKEBACK',
                        disposalReason: '유통기한 만료',
                        disposalDate: '2023-06-11T13:25:00',
                        takebackId: 'TB-20230002',
                        createdBy: '정책임'
                    }
                ],
                pageable: {
                    pageNumber: 0,
                    pageSize: 10,
                    sort: {
                        sorted: true,
                        unsorted: false,
                        empty: false
                    },
                    offset: 0,
                    paged: true,
                    unpaged: false
                },
                totalPages: 1,
                totalElements: 5,
                last: true,
                size: 10,
                number: 0,
                sort: {
                    sorted: true,
                    unsorted: false,
                    empty: false
                },
                numberOfElements: 5,
                first: true,
                empty: false
            };
        }

        // API 호출 대신 샘플 데이터 사용 (실제 구현 시 제거)
        function loadDisposals() {
            showLoading();

            // 실제 API 호출 대신 샘플 데이터 사용
            setTimeout(() => {
                const result = getSampleData();
                renderDisposals(result.content);
                renderPagination(result.totalPages);
                hideLoading();
            }, 500);
        }

        // 폐기 상세 정보 표시 함수 (샘플 데이터 사용)
        function showDisposalDetail(disposalId) {
            // 샘플 데이터에서 해당 ID의 폐기 정보 찾기
            const disposal = getSampleData().content.find(d => d.disposalId === disposalId);

            if (disposal) {
                // 모달에 데이터 표시
                document.getElementById('detailDisposalId').textContent = disposal.disposalId;
                document.getElementById('detailDisposalDate').textContent = formatDate(disposal.disposalDate);
                document.getElementById('detailFranchise').textContent = disposal.franchiseName || '-';
                document.getElementById('detailWarehouse').textContent = disposal.warehouseName || '-';
                document.getElementById('detailProductName').textContent = disposal.productName;
                document.getElementById('detailCategory').textContent = disposal.categoryName;
                document.getElementById('detailQuantity').textContent = disposal.quantity;
                document.getElementById('detailDisposalType').textContent = disposal.disposalType === 'NORMAL' ? '일반 폐기' : '반품 폐기';
                document.getElementById('detailReason').textContent = disposal.disposalReason;
                document.getElementById('detailCreatedBy').textContent = disposal.createdBy;

                // 반품 정보 표시 여부
                const takebackContainer = document.getElementById('detailTakebackContainer');
                if (disposal.disposalType === 'TAKEBACK' && disposal.takebackId) {
                    takebackContainer.classList.remove('hidden');
                    document.getElementById('detailTakeback').textContent = `반품 ID: ${disposal.takebackId}`;
                } else {
                    takebackContainer.classList.add('hidden');
                }

                // 모달 표시
                disposalDetailModal.classList.add('show');
            } else {
                showToast('폐기 상세 정보를 찾을 수 없습니다.', 'error');
            }
        }
    });
</script>
</body>
</html>